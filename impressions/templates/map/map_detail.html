{% extends "base.html" %}
{% load staticfiles %}

{% block title %}Map View{% endblock %}

{% block stylesheets %}

    <link rel="stylesheet" href="{% static 'css/leaflet.css' %}" type="text/css"/>
  {{ block.super }}
{% endblock stylesheets %}

{% block javascript %}
  {{ block.super }}
  <script src="{% static 'js/leaflet.js' %}" type="text/javascript"></script>
  <!-- JavaScript variables from Django -->
  <script type="text/javascript">
    //var sitesJson = {{ sites_json|safe }};
    // sitesJson will be picked up by js/map.js
    // site_values is a list of the "site_info" for each site. Site info is grabbed from
    // respective evidence, context, place, special objects 
    var sitesJson = {{ site_values|safe }};
    var map_params = {
      "layerIndex": {{ object.layer_index }}
      /*"layers": [
      {% for layer in object.layer_list %}
        "{{layer.title}}"{% if not forloop.last %}, {% endif %}       
      {% endfor %}            
      ] */
    };
  </script>
{% endblock javascript %}

{% block wrapper_class %}"content-wrapper-map"{% endblock wrapper_class %}

{% block content_area %}

  <div class="map-wrapper">
    <section class="map-control-panel">
      <h2 class="heading">Map Eras [Overlays]</h2>
      <p>Select era</p>
      
      <ul class="map-layers">
      {% for layer in object.layer_list %}
        {% if layer.slug = object.slug %}
          <li class="map-layers--item">{{ layer.title|safe }} - {{ layer.era_description|safe }}</li>
        {% else %}
          <li><a href="{% url 'map:map_detail' layer.slug %}">{{ layer.title|safe }} - {{ layer.era_description|safe }}</a></li>
        {% endif %}
      {% endfor %}
      </ul>
    </section>

    <section class="map-area">
      <div id="map"></div>
      <script src="{% static 'js/map.js' %}" type="text/javascript"></script>
    </section>
  </div><!--map-wrapper-->

  <section class="map-about-panel">
    <h2 class="heading">About This Map</h2>
    {{ object.layer_blurb|safe}}

    <h2 class="heading">Sites</h2>
    <ul class="map-sites">
    {% for site in object.sites.all %} {# site_values #}
        <li>- {{ site.site_type }}: {{ site.site_info.title }}</li>    
    {% endfor %}
    </ul>

    <h2 class="heading">Dig Deeper</h2>
    <ul class="map-deeper">
      {% for person in object.people.all %}
      <li>
        <a class="pop_item" href="{% url 'supporting:person_detail' person.slug %}">
          {{ person.first_name }} {{ person.last_name }}
        </a>
      </li>
      {% endfor %}
      {% for evidenceitem in object.evidence.all %}
        <li>
          <a class="pop_item" href="{% url 'supporting:evidenceitem_detail' evidenceitem.slug %}">
            {{ evidenceitem.title }}
          </a>
        </li>
      {% endfor %}
      {% for context in object.contexts.all %}
        <li>
          <a class="pop_item" href="{% url 'supporting:context_detail' context.slug %}">
            {{ context.title }}
          </a>
        </li>
      {% endfor %}
    </ul>      
  </section>


{% endblock content_area %}
